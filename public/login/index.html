<!-- public/login/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>福州大学校园管理系统 - 登录/注册</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", "PingFang SC", sans-serif;
      }
      body {
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .wrap {
        width: 100%;
        max-width: 460px;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 14px 35px rgba(0, 0, 0, 0.25);
        overflow: hidden;
      }
      .hdr {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        color: #fff;
        padding: 28px 22px;
        text-align: center;
      }
      .tabs {
        display: flex;
        border-bottom: 1px solid #eee;
      }
      .tab {
        flex: 1;
        text-align: center;
        padding: 12px 0;
        cursor: pointer;
        font-weight: 600;
        background: #f6f7fb;
        color: #555;
      }
      .tab.active {
        background: #fff;
        color: #2575fc;
        border-bottom: 3px solid #2575fc;
      }
      .pane {
        display: none;
        padding: 22px;
      }
      .pane.active {
        display: block;
        animation: fade 0.4s ease;
      }
      @keyframes fade {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }
      .fg {
        margin-bottom: 16px;
        position: relative;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
      }
      input,
      select {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .btn {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 8px;
        color: #fff;
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        font-weight: 700;
        cursor: pointer;
      }
      .msg {
        display: none;
        margin-bottom: 14px;
        border-radius: 8px;
        padding: 10px 12px;
      }
      .msg.error {
        background: #ffeaea;
        color: #b42318;
      }
      .msg.ok {
        background: #e8f5e9;
        color: #1e8e3e;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="hdr">
        <h1>福州大学校园管理系统</h1>
        <p>登录或注册账号</p>
      </div>

      <div class="tabs">
        <div class="tab active" data-for="stu">学生登录</div>
        <div class="tab" data-for="adm">管理员登录</div>
        <div class="tab" data-for="reg">注册</div>
      </div>

      <div id="msg" class="msg"></div>

      <!-- 学生登录 -->
      <div id="pane-stu" class="pane active">
        <div class="fg">
          <label>学号</label>
          <input id="stu-no" placeholder="请输入学号" />
        </div>
        <div class="fg">
          <label>密码</label>
          <input id="stu-pw" type="password" placeholder="请输入密码" />
        </div>
        <button id="btn-stu" class="btn">登录</button>
      </div>

      <!-- 管理员登录（后端同一个 /login，role 校验由后端控制） -->
      <div id="pane-adm" class="pane">
        <div class="fg">
          <label>管理员账号</label>
          <input id="adm-user" placeholder="请输入账号" />
        </div>
        <div class="fg">
          <label>密码</label>
          <input id="adm-pw" type="password" placeholder="请输入密码" />
        </div>
        <button id="btn-adm" class="btn">登录</button>
      </div>

      <!-- 注册 -->
      <div id="pane-reg" class="pane">
        <div class="fg">
          <label>学号</label><input id="reg-no" placeholder="学号" />
        </div>
        <div class="fg">
          <label>姓名</label><input id="reg-name" placeholder="姓名" />
        </div>
        <div class="fg">
          <label>学院</label><input id="reg-college" placeholder="学院" />
        </div>
        <div class="fg">
          <label>专业</label><input id="reg-major" placeholder="专业" />
        </div>
        <div class="fg">
          <label>年级</label>
          <select id="reg-grade">
            <option value="">请选择</option>
            <option>大一</option>
            <option>大二</option>
            <option>大三</option>
            <option>大四</option>
            <option>研究生</option>
          </select>
        </div>
        <div class="fg">
          <label>楼号</label>
          <select id="reg-building"></select>
        </div>
        <div class="fg">
          <label>宿舍号</label><input id="reg-room" placeholder="如 525" />
        </div>
        <div class="fg">
          <label>手机号</label><input id="reg-phone" placeholder="手机" />
        </div>
        <div class="fg">
          <label>密码</label
          ><input id="reg-pw" type="password" placeholder="密码" />
        </div>
        <button id="btn-reg" class="btn">注册</button>
      </div>
    </div>

    <script>
      const ORIGIN = location.origin;
      const AUTH = `${ORIGIN}/api/auth`;

      // tabs
      document.querySelectorAll(".tab").forEach((t) => {
        t.onclick = () => {
          document
            .querySelectorAll(".tab")
            .forEach((x) => x.classList.remove("active"));
          document
            .querySelectorAll(".pane")
            .forEach((x) => x.classList.remove("active"));
          t.classList.add("active");
          document
            .getElementById("pane-" + t.dataset.for)
            .classList.add("active");
          hide();
        };
      });

      // 工具
      const show = (txt, ok = false) => {
        const m = document.getElementById("msg");
        m.className = `msg ${ok ? "ok" : "error"}`;
        m.textContent = txt;
        m.style.display = "block";
      };
      const hide = () => {
        const m = document.getElementById("msg");
        m.style.display = "none";
      };

      // 注册：楼号 1~65
      const sel = document.getElementById("reg-building");
      sel.innerHTML =
        '<option value="">请选择</option>' +
        Array.from({ length: 65 }, (_, i) => `<option>${i + 1}</option>`).join(
          ""
        );

      // 学生登录
      document.getElementById("btn-stu").onclick = async () => {
        const student_no = document.getElementById("stu-no").value.trim();
        const password = document.getElementById("stu-pw").value;
        if (!student_no || !password) return show("请输入学号和密码");
        try {
          const r = await fetch(`${AUTH}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ student_no, password }),
          });
          const j = await r.json();
          if (!r.ok) return show(j.msg || "登录失败");
          localStorage.setItem("token", j.data.token);
          localStorage.setItem("user", JSON.stringify(j.data.user || {}));
          show("登录成功", true);
          setTimeout(() => location.replace("/dashboard/"), 500);
        } catch (e) {
          show("服务器连接失败");
        }
      };

      // 管理员登录（示例）
      document.getElementById("btn-adm").onclick = async () => {
        const username = document.getElementById("adm-user").value.trim();
        const password = document.getElementById("adm-pw").value;
        if (!username || !password) return show("请输入账号和密码");
        try {
          const r = await fetch(`${AUTH}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });
          const j = await r.json();
          if (!(j.code === 0 && j.data?.role === "admin"))
            return show(j.msg || "非管理员账号");
          localStorage.setItem("token", j.data.token);
          localStorage.setItem("user", JSON.stringify(j.data));
          show("管理员登录成功", true);
          setTimeout(() => location.replace("/dashboard/"), 500);
        } catch (e) {
          show("服务器连接失败");
        }
      };

      // 注册
      document.getElementById("btn-reg").onclick = async () => {
        const payload = {
          student_no: document.getElementById("reg-no").value.trim(),
          real_name: document.getElementById("reg-name").value.trim(),
          college: document.getElementById("reg-college").value.trim(),
          major: document.getElementById("reg-major").value.trim(),
          grade: document.getElementById("reg-grade").value,
          building_no: document.getElementById("reg-building").value,
          room_no: document.getElementById("reg-room").value.trim(),
          password: document.getElementById("reg-pw").value,
          phone: document.getElementById("reg-phone").value.trim(),
        };
        if (Object.values(payload).some((v) => !v))
          return show("请填写所有必填项");
        try {
          const r = await fetch(`${AUTH}/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const j = await r.json();
          if (!r.ok) return show(j.msg || "注册失败");
          show("注册成功，请登录", true);
          document.querySelector('.tab[data-for="stu"]').click();
        } catch (e) {
          show("服务器连接失败");
        }
      };
    </script>
  </body>
</html>
